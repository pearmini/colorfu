<template>
  <el-container class="container">
    <el-aside width="300px">
      <attribute-tree :options="attribute" :values="example" />
    </el-aside>
    <el-container>
      <div
        :style="{
          transform: `translate(${transformed.translateX}px, ${transformed.translateY}px) scale(${transformed.scale}, ${transformed.scale})`,
          transformOrigin: 'left top',
        }"
      >
        <wallpaper
          :options="example"
          :mode="example.mode"
          :width="windowWidth"
          :height="windowHeight"
        />
      </div>
    </el-container>
  </el-container>
</template>

<script>
import Wallpaper from "../components/Wallpaper.vue";
import AttributeTree from "../components/AttributeTree.vue";
import { useWindowSize } from "../mixins/useWindowSize";
import fontURL from "../assets/font/en.woff2";
import { getAttributeOptions } from "../utils/attribute";

export default {
  components: {
    Wallpaper,
    AttributeTree,
  },
  data() {
    return {
      example: {
        mode: "color",
        title: "How are you?",
        fontSize: 200,
        fontFamily: "Luckiest Guy",
        fontURL,
        background: "#fcbc23",
        text: "#532582",
      },
    };
  },
  mixins: [useWindowSize()],
  computed: {
    attribute() {
      return getAttributeOptions(this.example.mode);
    },
    transformed() {
      const padding = 50;
      const mainHeight = this.windowHeight - 61;
      const mainWidth = this.windowWidth - 300;
      const width = mainWidth - padding * 2;
      const height = mainHeight - padding * 2;
      const sh = height / this.windowHeight;
      const sw = width / this.windowWidth;
      const scale = Math.min(sh, sw);
      const translateX = (mainWidth - this.windowWidth * scale) / 2;
      const translateY = (mainHeight - this.windowHeight * scale) / 2;
      return {
        scale,
        translateX,
        translateY,
      };
    },
  },
  beforeRouteEnter(from, to, next) {
    next((vm) => {
      const example = localStorage.getItem("cd-example");
      if (example) {
        vm.example = JSON.parse(example);
      }
    });
  },
};
</script>

<style scoped>
.container {
  height: calc(100vh - 61px);
}

.el-footer {
  background-color: #b3c0d1;
}

.el-aside {
  background-color: #d3dce6;
}

.el-container {
  background-color: #e9eef3;
  overflow: hidden;
  padding: 0px;
}
</style>